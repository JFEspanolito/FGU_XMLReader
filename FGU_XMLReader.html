<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Visor de XML</title>
    <style>
        .tab-button {
            background-color: #808080;
            color: black;
            border: 2px solid #333;
            border-radius: 5px 5px 0 0;
            padding: 6px 12px;
            margin-right: 4px;
            font-weight: bold;
            cursor: pointer;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }

        .tab-button.active {
            background-color: #808080;
            color: white;
        }

        .tab-button:hover {
            filter: brightness(1.2);
        }

        input[type="text"], input[type="number"], textarea {
            text-align: center;
        }
    </style>
</head>

<body>
    <h1 style="text-align: center;">Importador/Exportador de XML</h1>

    <div style="display: flex; justify-content: space-between; max-width: 600px; margin: 0 auto;">
        <div>
            <button onclick="document.getElementById('fileInput').click()">Importar XML</button>
            <input type="file" id="fileInput" accept=".xml" style="display:none" onchange="importarXML()">
        </div>
        <div>
            <div id="nombreArchivoXML"></div>
        </div>
        <div>
            <button onclick="exportarXML()">Exportar XML</button>
        </div>
    </div>

    <div id="tabPanel" style="margin-top: 20px; display: none; text-align: center;">
        <button class="tab-button" onclick="mostrarVistaMain(this)">Main</button>
        <button class="tab-button" onclick="mostrarVistaCombat(this)">Combat</button>
        <button class="tab-button" onclick="mostrarVistaSkills(this)">Skills</button>
        <button class="tab-button" onclick="mostrarVistaAbilities(this)">Abilities</button>
        <button class="tab-button" onclick="mostrarVistaInventory(this)">Inventory</button>
        <button class="tab-button" onclick="mostrarVistaNotes(this)">Notes</button>
        <button class="tab-button" onclick="mostrarVistaActions(this)">Actions</button>
    </div>

    <div id="vistaMain" style="text-align: center; margin-top: 20px; display: none;">
        <div id="datosMain"></div>
        <div class="attr-block" id="atributos" style="display: flex; justify-content: center; flex-wrap: wrap; gap: 12px; margin-top: 20px;"></div>
    </div>

    <script>
        let xmlDocOriginal = null;

        function importarXML() {
            const input = document.getElementById('fileInput');
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {

                console.log("[LOG] XML cargado desde archivo: " + file.name);
                document.getElementById('nombreArchivoXML').textContent = "Archivo cargado: " + file.name;

                const parser = new DOMParser();
                xmlDocOriginal = parser.parseFromString(e.target.result, 'application/xml');
                document.getElementById('tabPanel').style.display = 'block';
                mostrarVistaMain();
            };
            reader.readAsText(file);
        }

        function exportarXML() {
            if (!xmlDocOriginal) {
                alert("No hay ningún XML cargado para exportar.");
                return;
            }

            const serializer = new XMLSerializer();
            const xmlStr = serializer.serializeToString(xmlDocOriginal);
            const blob = new Blob([xmlStr], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'personaje.xml';
            a.click();
            URL.revokeObjectURL(url);
        }

        function activarPestanaActiva(btn) {
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
        }

        function mostrarVistaMain() {
    if (!xmlDocOriginal) return;

    // Ocultar otras vistas
    document.getElementById('vistaMain').style.display = 'block';
    activarPestanaActiva(document.querySelector('.tab-button'));

    const datosMain = document.getElementById('datosMain');
    datosMain.innerHTML = '';

    const wrapper = document.createElement('div');
    wrapper.style = 'display: flex; justify-content: space-between; gap: 20px; flex-wrap: wrap;';

    // Columna Izquierda
    const col1 = document.createElement('div');
    col1.style = 'flex: 1; min-width: 200px; max-width: 220px; margin-left: 50px;';

    const campos1 = [
        ['Nombre', 'character > name'],
        ['Género', 'character > gender'],
        ['Edad', 'character > age'],
        ['Altura', 'character > height'],
        ['Peso', 'character > weight'],
        ['Tamaño', 'character > size'],
        ['Alineación', 'character > alignment'],
        ['Deidad', 'character > deity'],
        ['Raza', 'character > languagelist > * > name'],
        ['Clase', 'character > classes > * > name'],
        ['Nivel', 'character > level'],
        ['Damage Reduction', 'character > damage_reduction'],
        ['Resistance', 'character > resistance'],
        ['Immunities', 'character > immunities'],
        ['Special Qualities', 'character > special_qualities'],
        ['Sentidos', 'character > senses']
    ];
    campos1.forEach(([label, path]) => {
        const nodo = xmlDocOriginal.querySelector(path);
        if (!nodo) return;
        const div = document.createElement('div');
        div.style = 'margin-bottom: 4px;';
        div.innerHTML = `<label><b>${label}:</b></label><input type="text" value="${nodo.textContent.trim()}" style="width: 100%;" data-node="${path}">`;
        div.querySelector('input').oninput = function () {
            const target = xmlDocOriginal.querySelector(path);
            if (target) target.textContent = this.value.trim();
        };
        col1.appendChild(div);
    });

    // Columna Centro
    const col2 = document.createElement('div');
    col2.style = 'flex: 1; min-width: 220px; display: flex; flex-direction: column; align-items: center;';

    const stats = ['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma'];

    stats.forEach(stat => {
        const nodo = xmlDocOriginal.querySelector(stat);
        if (!nodo) return;

        const scoreNode = nodo.querySelector('score');
        const dmgNode = nodo.querySelector('damage');
        const score = parseInt(scoreNode?.textContent || '0');
        const dmg = parseInt(dmgNode?.textContent || '0');
        const mod = Math.floor((score - dmg - 10) / 2);
        const label = stat.substring(0, 3).toUpperCase();

        const bloque = document.createElement('div');
        bloque.style = 'margin-bottom: 8px; text-align: center;';

        bloque.innerHTML = `
            <div><b>${label}</b></div>
            <div style="display: flex; justify-content: center; gap: 10px; font-size: 12px; margin-bottom: 2px;">
                <span style="display: inline-block; width: 50px; text-align: center;">Score</span>
                <span style="display: inline-block; width: 50px; text-align: center;">MOD</span>
                <span style="display: inline-block; width: 50px; text-align: center;">DMG</span>
            </div>
            <div style="display: flex; justify-content: center; gap: 10px;">
                <input type="number" value="${score}" style="width: 50px;"
                    onchange="xmlDocOriginal.querySelector('${stat} > score').textContent = this.value.trim(); mostrarVistaMain();">
                <span style="display: inline-block; width: 50px; text-align: center;"><b>${mod >= 0 ? '+' : ''}${mod}</b></span>
                <input type="number" value="${dmg}" style="width: 50px;"
                    onchange="xmlDocOriginal.querySelector('${stat} > damage').textContent = this.value.trim(); mostrarVistaMain();">
            </div>
        `;
        col2.appendChild(bloque);
    });

    const otrosCentro = [
        ['AC', 'ac > total'],
        ['Iniciativa', 'initiative > total'],
        ['Velocidad', 'speed > total'],  // solo este cambia
        ['Will', 'will > total'],
        ['Reflex', 'reflex > total'],
        ['Fort', 'fortitude > total']
    ];

    otrosCentro.forEach(([label, path]) => {
        const nodo = xmlDocOriginal.querySelector(path);
        if (!nodo) return;
        const div = document.createElement('div');
        div.style = 'margin-bottom: 6px;';
        div.innerHTML = `<label><b>${label}:</b></label></br><input type="text" value="${nodo.textContent.trim()}" style="min-width: 200px; max-width: 220px;" data-node="${path}">`;
        div.querySelector('input').oninput = function () {
            xmlDocOriginal.querySelector(path).textContent = this.value.trim();
        };
        col2.appendChild(div);
    });

    // Columna Derecha
    const col3 = document.createElement('div');
    col3.style = 'flex: 1; min-width: 200px; max-width: 220px; margin-right: 50px;';

    const campos3 = [
        ['HP Máximo', 'character > hp > total'],
        ['Temp HP', 'character > temp'],
        ['Wounds', 'character > wounds'],
        ['Subdual', 'character > subdual'],
        ['BAB', 'character > attackbonus > base'],
        ['Melee', 'character > attackbonus > melee > total'],
        ['Ranged', 'character > attackbonus > ranged > total'],
        ['CMB', 'character > attackbonus > grapple > total'],
        ['CMD', 'character > cmd'],
        ['FF', 'character > ff'],
        ['Tch', 'character > touch'],
        ['SR', 'character > sr'],
        ['Special Movement', 'character > specialmovement'],
        ['Notas', 'character > notes_main']
    ];

    campos3.forEach(([label, path]) => {
        const nodo = xmlDocOriginal.querySelector(path);
        if (!nodo) return;

        const cont = document.createElement('div');
        cont.style = 'margin-bottom: 6px;';

        const lbl = document.createElement('label');
        lbl.textContent = `${label}: `;
        lbl.style = 'font-weight: bold;';

        let input;
        if (label === 'Notas') {
            input = document.createElement('textarea');
            input.rows = 3;
            input.style = 'width: 100%;';
        } else {
            input = document.createElement('input');
            input.type = 'text';
            input.style = 'width: 100%;';
        }

        input.value = nodo.textContent.trim();
        input.oninput = () => {
            nodo.textContent = input.value.trim();
        };

        cont.appendChild(lbl);
        cont.appendChild(input);
        col3.appendChild(cont);
    });

    document.getElementById('vistaMain').style.display = 'block';
    wrapper.appendChild(col1);
    wrapper.appendChild(col2);
    wrapper.appendChild(col3);
    datosMain.appendChild(wrapper);
    document.getElementById('vistaMain').style.display = 'block';
}
    </script>
</body>
</html>